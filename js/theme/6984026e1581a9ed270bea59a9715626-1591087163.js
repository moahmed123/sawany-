
csModule('$.easyZoom',['jQuery','csBrowser'],function($,csBrowser){(function($){'use strict';var dw,dh,rw,rh,lx,ly;var defaults={loadingNotice:'Loading image',errorNotice:'The image could not be loaded',errorDuration:2500,linkAttribute:'href',preventClicks:true,beforeShow:$.noop,beforeHide:$.noop,onShow:$.noop,onHide:$.noop,onMove:$.noop};function EasyZoom(target,options){this.$target=$(target);this.opts=$.extend({},defaults,options,this.$target.data());this.isOpen===undefined&&this._init();}
EasyZoom.prototype._init=function(){this.$link=this.$target.find('.j-zoom-link');this.$image=this.$target.find('.j-zoom-image');this.$flyout=$('<div class="easyzoom-flyout" />');this.$notice=$('<div class="easyzoom-notice" />');this.$target.on({'mousemove.easyzoom':$.proxy(this._onMove,this),'mouseleave.easyzoom':$.proxy(this._onLeave,this),'mouseenter.easyzoom':$.proxy(this._onEnter,this)});this.opts.preventClicks&&this.$target.on('click.easyzoom',function(e){e.preventDefault();});};EasyZoom.prototype.show=function(e,testMouseOver){var w1,h1,w2,h2;var self=this;if(this.opts.beforeShow.call(this)===false)return;if(!this.isReady){return this._loadImage(this.$link.attr(this.opts.linkAttribute),function(){if(self.isMouseOver||!testMouseOver){self.show(e);}});}
this.$target.append(this.$flyout);w1=this.$target.width();h1=this.$target.height();w2=this.$flyout.width();h2=this.$flyout.height();dw=this.$zoom.width()-w2;dh=this.$zoom.height()-h2;rw=dw/w1;rh=dh/h1;this.isOpen=true;this.opts.onShow.call(this);e&&this._move(e);};EasyZoom.prototype._onEnter=function(e){if(csBrowser.touch)return;e.preventDefault();this.isMouseOver=true;this.show(e,true);};EasyZoom.prototype._onMove=function(e){if(!this.isOpen||csBrowser.touch)return;e.preventDefault();this._move(e);};EasyZoom.prototype._onLeave=function(){this.isMouseOver=false;this.isOpen&&this.hide();};EasyZoom.prototype._onLoad=function(e){if(!e.currentTarget.width)return;this.isReady=true;this.$notice.detach();this.$flyout.html(this.$zoom);this.$target.removeClass('is-loading').addClass('is-ready');e.data.call&&e.data();};EasyZoom.prototype._onError=function(){var self=this;this.$notice.text(this.opts.errorNotice);this.$target.removeClass('is-loading').addClass('is-error');this.detachNotice=setTimeout(function(){self.$notice.detach();self.detachNotice=null;},this.opts.errorDuration);};EasyZoom.prototype._loadImage=function(href,callback){var zoom=new Image;this.$target.addClass('is-loading').append(this.$notice.text(this.opts.loadingNotice));this.$zoom=$(zoom).on('error',$.proxy(this._onError,this)).on('load',callback,$.proxy(this._onLoad,this));zoom.style.position='absolute';zoom.src=href;};EasyZoom.prototype._move=function(e){lx=e.pageX||lx;ly=e.pageY||ly;var offset=this.$target.offset();var pt=ly-offset.top;var pl=lx-offset.left;var xt=Math.ceil(pt*rh);var xl=Math.ceil(pl*rw);if(xl<0||xt<0||xl>dw||xt>dh){this.hide();}else{var top=xt*-1;var left=xl*-1;this.$zoom.css({top:top,left:left});this.opts.onMove.call(this,top,left);}};EasyZoom.prototype.hide=function(){if(!this.isOpen)return;if(this.opts.beforeHide.call(this)===false)return;this.$flyout.detach();this.isOpen=false;this.opts.onHide.call(this);};EasyZoom.prototype.swap=function(standardSrc,zoomHref,srcset){this.hide();this.isReady=false;this.detachNotice&&clearTimeout(this.detachNotice);this.$notice.parent().length&&this.$notice.detach();this.$target.removeClass('is-loading is-ready is-error');this.$image.attr({src:standardSrc,srcset:$.isArray(srcset)?srcset.join():srcset});this.$link.attr(this.opts.linkAttribute,zoomHref);};EasyZoom.prototype.teardown=function(){this.hide();this.$target.off('.easyzoom').removeClass('is-loading is-ready is-error');this.detachNotice&&clearTimeout(this.detachNotice);delete this.$link;delete this.$zoom;delete this.$image;delete this.$notice;delete this.$flyout;delete this.isOpen;delete this.isReady;};$.fn.easyZoom=function(options){return this.each(function(){var api=$.data(this,'easyZoom');if(!api){$.data(this,'easyZoom',new EasyZoom(this,options));}else if(api.isOpen===undefined){api._init();}});};if(typeof define==='function'&&define.amd){define(function(){return EasyZoom;});}else if(typeof module!=='undefined'&&module.exports){module.exports=EasyZoom;}})(jQuery);return $;});
csModule(['jQuery','csUtils','csBrowser','waitUntil','ABTest','Storage','$.maketabs'],function($,csUtils,csBrowser,waitUntil,ABTest,Storage){'use strict';(function(){Childrensalon.initMeasurements=function($tab){if($tab.hasClass('measurements-inited'))return;$tab.addClass('measurements-inited');var container=$tab.find('.measurements-table-redesign').first(),selectEl=$('<select/>');csModule(['Translator'],function(Translator){$('<option/>',{value:'cm'}).text(Translator?Translator.translate('Centimetres'):'Centimetres').appendTo(selectEl);$('<option/>',{value:'inch'}).text(Translator?Translator.translate('Inches'):'Inches').appendTo(selectEl);});$tab.find('.new-measurements-table').find('tr').find('td:first').css('minWidth','180px');selectEl.insertBefore(container);selectEl.on('change',function(){measurements_units_change(this,$tab)});csUtils.makeTableResponsive(container);checkSizes($tab);};function checkSizes($tab){var sku=$tab.data('sku'),sizes=[];if(!sku){return;}
if(Childrensalon.catalogProductItem&&Childrensalon.catalogProductItem[sku]){if(Childrensalon.catalogProductItem[sku].product&&Childrensalon.catalogProductItem[sku].product.variants){$.each(Childrensalon.catalogProductItem[sku].product.variants,function(index,variant){if(variant.size.code){sizes.push(variant.size.code);}});}}else{return;}
if(sizes.length){var $table=$(this);$tab.find('.measurements-table-redesign').find('td[data-size]').each(function(){var $td=$(this);if($.inArray($td.data('size').toString(),sizes)===-1){$td.parent().addClass('no-display')}});}}
function measurements_units_change(elem,$tab){csModule(['Translator'],function(Translator){var type=$(elem).val(),cm=' '+(Translator?Translator.translate('cm'):'cm'),kg=' '+(Translator?Translator.translate('kg'):'kg'),lbs=' '+(Translator?Translator.translate('lbs'):'lbs');$tab.find('.measurement-value').each(function(){var $this=$(this),is_weight=$this.data('type')=='weight',value=$this.data('origValue')?$this.data('origValue'):parseFloat($this.html());if(!isNaN(value)){if(is_weight){if(type=='cm'){$this.html(value+kg);}else{$this.data('origValue',value);value=value*2.205;if(Math.abs(value-Math.round(value))<1e-2){value=Math.round(value);}else{value=value.toFixed(1);}
$this.html(''+value+lbs);}}else{if(type=='cm'){$this.html(value+cm);}else{$this.data('origValue',value);$this.html(measurements_format_inches(value/2.54));}}}});});}
function measurements_format_inches(inches){var fractions=[{'value':0},{'value':1/8,'code':'&#8539;'},{'value':1/4,'code':'&frac14;'},{'value':1/2,'code':'&frac12;'},{'value':3/4,'code':'&frac34;'},{'value':1}];var inchesInteger=Math.floor(inches);var inchesFraction=inches-inchesInteger;var fraction={};var minDiff=null;for(var i=0;i<fractions.length;i++){var diff=Math.abs(fractions[i].value-inchesFraction);if(minDiff===null||diff<minDiff){minDiff=diff;fraction=fractions[i];}}
if(fraction.value&&!fraction.code){inchesInteger+=fraction.value;}
return inchesInteger+(fraction.code?fraction.code:'')+'"';}})();$(function(){var $window=$(window),$body=$(document.body);(function(){var $wrap=$('.product-view');$('.view-product-detail').on('click',function(e){$wrap.fadeTo(500,0.2);setTimeout(function(){$wrap.removeClass('short-product-view');$body.removeClass('short-product-view-body');$wrap.fadeTo(500,1);var _slider=$('.product-img-box .slides').data('bxSlider');if(_slider){_slider.redrawSlider();}
var $rocketShortProduct=$('.rocket-short-product-view'),$recommendGrid=$rocketShortProduct.find('.recommend-grid');if($rocketShortProduct.length){$rocketShortProduct.removeClass('rocket-short-product-view short-product-view-element');$rocketShortProduct.find('.rocket-title').addClass('no-display');$recommendGrid.addClass('tab-content flex-carusel').removeClass('recommend-grid');}
$('.product-tabs').maketabs({onAfter:function(){if($rocketShortProduct.length){csModule(['CSflexCarusel'],function(CSflexCarusel){CSflexCarusel($recommendGrid);});}}});if(csBrowser.state!=='mobile'){$('.detail_info .dot-description .description-text').trigger('cs.update.dot');}},500);e.preventDefault();});if($wrap.hasClass('short-product-view')){$body.addClass('short-product-view-body');}})();waitUntil.on(['loadTimeout'],function(){var $productTabs=$('.product-tabs'),tabsPriority=['.youmightlike-tab','.outfit-tab'];function openTab(){setTimeout(function(){$.each(tabsPriority,function(_,tab){var $tab=$productTabs.find(tab),$active=$productTabs.find('.tab-title.active');if($tab.length&&!$tab.hasClass('no-display')){if(!$tab.is($active)){$productTabs.data('makeTabs').options.active=(csBrowser.state==='mobile'?$tab.parent().index():$tab.index());$active.trigger('clickTab');$tab.trigger('clickTab');}
return false;}})})}
$productTabs.on('tabsInited',openTab).on('carouselInited','.flex-carusel',openTab);function tabLoaded($this,$tab){$tab.trigger('tabLoaded');$tab.removeClass('tab-loading');}
$productTabs.find('.ajax-tab').on('openTab',function(e){var $this=$(e.currentTarget),_data=$this.data(),_url=_data.url,$tab=_data.tab.children('.tab-content');if(_data.opened){if($this.hasClass('outfit-tab')){$tab.find('.product-image-container').trigger('openTab');}
return;}
_data.opened=1;$tab.addClass('tab-loading');if(document.location.protocol=='https:'){_url=_url.replace(/^http:/,'https:');}
$.ajax({url:csUtils.addUrlParam(_url,'isAjax=1'),xhrFields:{withCredentials:true}}).done(function(data){$tab.html(data);if($this.hasClass('sizeguide-tab')){tabLoaded($this,$tab);$tab.find('.tab').removeClass('tab no-display');csUtils.makeTableResponsive($tab.find('.sgp-content table'));}else if($this.hasClass('deliveryreturns-tab')){csModule(['deliverySelector'],function(deliverySelector){tabLoaded($this,$tab);deliverySelector($tab);});}else if($this.hasClass('outfit-tab')){csModule(['initProductDetail'],function(initProductDetail){tabLoaded($this,$tab);initProductDetail($tab.find('.outfit-product-view'),true);});}
$window.trigger('DOMChanged',$tab);$tab.trigger('tabLoaded');}).fail(function(){$tab.html('<p>Sorry but there was an error loading page.</p>');$tab.removeClass('tab-loading');});});$productTabs.find('.measurments-tabtitle').on('openTab',function(e){Childrensalon.initMeasurements($(this).data('tab'));});if(!$('.product-view').hasClass('short-product-view')){$productTabs.maketabs({active:$productTabs.find('.tab-title').not('.no-display').first().parent().index()});}});$('.detail_info').each(function(){var $detailInfo=$('.detail_info');$detailInfo.find('.tab-title').one('openTab',function(){var $text=$detailInfo.find('.dot-description .description-text');csUtils.dotdotdot($text,function(){var _lineHeight=parseFloat($text.css('lineHeight')),_height=$text.height();return _height>7*_lineHeight;},$('<span class="read-more">Read more</span>'),$('<span class="read-less">Read less</span>'),function(){$text.removeClass('less-text');},function(){$text.addClass('less-text');},{callback:function(){$text.removeClass('less-text');}});})});});});csModule('Component.carouselTab',['CSflexCarusel'],function(CSflexCarusel){return function($tab){CSflexCarusel($tab);}});
csModule('initProductDetail',['jQuery','csUtils','applyWishlistToProduct','csBrowser'],function($,csUtils,applyWishlistToProduct,csBrowser){return function($container,isAjax){'use strict';var $window=$(window);$container.find('.product-img-box').each(function(){var $imgBox=$(this),$moreViews=$imgBox.find('.more-views .slides'),$thumbs=$moreViews.children(),$sliderWrap=$imgBox.find('.slider-wrap'),$mainSlider=$sliderWrap.children(),$active=$mainSlider.find('.active'),_start=0,_mainSlider,_count=csBrowser.state==='desktop'?4:3,$popupImageLink=$imgBox.find('.popup-image-link'),$imageContainer=$imgBox.find('.product-image-container'),$zoomCursor=$imgBox.find('.zoomCursorHelp');if(isAjax){_count=3;}
var enableZoom=function($item){if(isAjax||$item.data('easyZoom'))return;csModule(['$.easyZoom'],function(){$item.easyZoom({'linkAttribute':'data-href','onShow':function(){$imageContainer.append(this.$flyout);}});});};if($active.length){_start=$active.data('index');enableZoom($active);}else{$active=$mainSlider.children().eq(_start);enableZoom($active);}
function initSlide($slide,oldIndex,newIndex){if($slide.hasClass('video-item')){$imgBox.addClass('show-video');_playVideo($slide);}else{enableZoom($slide);}
$thumbs.removeClass('active').eq(newIndex).addClass('active');if($moreViews.data('bxSlider')){$moreViews.data('bxSlider').goToSlide(Math.ceil((newIndex+1)/_count)-1);}}
var _player,_playerIsPlay,_playerType='';var _playVideo=function($slide){if(_player){_player.play();_playerIsPlay=true;}else{var $wrap=$slide.children(),_video=$wrap.attr('data-video');if(_video){if(_video.indexOf('youtube')!==-1||_video.indexOf('youtu.be')!==-1){_playerType='youtube';}else if(_video.indexOf('vimeo')!==-1){_playerType='vimeo'}
var $video=$('<video id="product-video" class="video-js" width="100%" height="100%"/>');$wrap.html($video);csModule(['videojs','videojsYoutube','videojsVimeo'],function(videojs){_player=videojs($video[0],{'controls':false,'autoplay':false,'muted':true,'playsinline':true,'preload':'auto','youtube':{'playsinline':1},'techOrder':[_playerType],'nativeControlsForTouch':true,'sources':[{'type':'video/'+_playerType,'src':_video}]});_player.play();_player.muted(false);_player.on('waiting',function(){var interval=setInterval(function(){if(_player&&_player.readyState()===0){_player.removeClass('vjs-waiting');clearInterval(interval);}},1000);})
_playerIsPlay=true;});}}};var _stopVideo=function(){if(_player&&_player.pause&&_playerIsPlay){_player.pause();_playerIsPlay=false;}};function initMainSlider(nextSlide){var _sliderSettings={startSlide:_start,pager:false,useCSS:true,onSliderLoad:function(){if(typeof nextSlide!=='undefined'&&typeof nextSlide!=='object'){this.goToSlide(nextSlide);}},onSlideBefore:initSlide,onSlideAfter:function($slide,oldIndex,newIndex){if(!$slide.hasClass('video-item')){_stopVideo();$imgBox.removeClass('show-video');}}};setTimeout(function(){if(_mainSlider){_mainSlider.reloadSlider(_sliderSettings);}else{csUtils.CSbxSlider($mainSlider,_sliderSettings,function(){_mainSlider=$mainSlider.data('bxSlider');});}});}
$thumbs.on('click',function(){if(_mainSlider){_mainSlider.goToSlide($(this).data('index'));}else{initMainSlider($(this).data('index'));}});function initMoreViewsSlider(){if(csBrowser.state==='mobile')return;if(!isAjax){_count=csBrowser.state==='desktop'?4:3;}
var _settings={startSlide:_start,infiniteLoop:false,hideControlOnEnd:true,responsive:false,mode:'vertical',pager:false,minSlides:_count,maxSlides:_count,touchEnabled:false,slideMargin:12};if($moreViews.data('bxSlider')){$moreViews.data('bxSlider').reloadSlider(_settings);}else{csUtils.CSbxSlider($moreViews,_settings);}}
$window.on('updatestate',function(){if(_player&&_player.dispose&&_playerType=='youtube'){_player.dispose();_player=null;}
initMainSlider();initMoreViewsSlider();});$imageContainer.on('openTab',initMainSlider);initMainSlider();initMoreViewsSlider();function getCurrentImageUrl(){return _mainSlider.getCurrentSlideElement().children().attr('data-hrefx2');}
$mainSlider.on('click',function(e){e.preventDefault();if(!_mainSlider||(isAjax&&!$container.hasClass('outfit-product-view')&&!$container.hasClass('j-with-image-popup'))||$imgBox.hasClass('show-video'))return;openZoomImagePopup('product-image-popup',getCurrentImageUrl(),$container);});$popupImageLink.on('click',function(){if(!_mainSlider)return;openZoomImagePopup('product-image-popup',getCurrentImageUrl(),$container);});$moreViews.find('.video-item').each(function(){var $wrap=$(this).children(),_video=$wrap.attr('data-video'),_re=/^.*(vimeo\.com\/)((channels\/[A-z]+\/)|(groups\/[A-z]+\/videos\/))?([0-9]+)/,_found,_id='';if(!_video)return;if(_video.indexOf('youtube')!==-1||_video.indexOf('youtu.be')!==-1){_id=_video.match(/(?:https?:\/{2})?(?:w{3}\.)?youtu(?:be)?\.(?:com|be)(?:\/watch\?v=|\/)([^\s&]+)/)[1];if(!_id)return;$wrap.css('backgroundImage','url(//img.youtube.com/vi/'+_id+'/mqdefault.jpg)');}else{_found=_video.match(_re);_found&&(_id=_found[5]);if(!_id)return;$.getJSON('//vimeo.com/api/v2/video/'+_id+'.json?callback=?',function(data){if(data[0]&&data[0].thumbnail_medium){$wrap.css('backgroundImage','url('+data[0].thumbnail_medium+')');}});}});if(!isAjax){csModule(['$.ui'],function(){$mainSlider.on('mousemove','>li:not(.video-item)',function(e){if(csBrowser.touch)return;$zoomCursor.removeClass('no-display').position({my:"left+10 top+10",of:e});}).on('mouseout',function(){$zoomCursor.addClass('no-display');});});}});$container.find('.emailme-preview-btn,.emailme-stock-btn').on('click',function(e){e.preventDefault();var $this=$(this);csModule(['subscribeProduct'],function(subscribeProduct){var productCode=$this.data('productCode');subscribeProduct(productCode,$this);});});(function(){var $addToCart=$container.find('.add-to-cart'),$toolTip=$addToCart.children('.cs-tool-tip');if($toolTip.length){csModule(['$.ui'],function(){$addToCart.on('mousemove',function(e){if(csBrowser.touch)return;$toolTip.position({my:'left-18 bottom-22',of:e,using:function(pos,ui){var $el=$(this);$el.css(pos);if(ui.target.left-ui.element.left>20){$el.addClass('right-position')}else{$el.removeClass('right-position')}}});});});}})();(function(){if(!$container.hasClass('outfit-product-view'))return;$container.find('#outfit-items-container').on('click','.product-image',function(e){if(csBrowser.state!=='mobile'){e.preventDefault();var $this=$(this),linkSku=$this.closest('form').attr('data-sku'),productSku=$('.product_addtocart_form').attr('data-sku');if(linkSku==productSku){$('body, html').animate({scrollTop:0},700);}else{csUtils.preloadPopup('openQuickview',[$this.attr('href'),function(popup){popup.addClass('outfit-product-quickview');}]);}}});})();$container.find('.color-filter select').on('change',function(event){if(!isAjax){top.location=this.value}});if(!$container.hasClass('outfit-product-view')&&$container.find('#attribute151').length){applyWishlistToProduct($container.find('#attribute151').val(),$container);}
$container.find('.add-to-links [data-action=add-to-wishlist]').on('click',function(e){e.preventDefault();if(typeof spConfig==='undefined'){return;}
var $action=$(this);var $productForm=$action.closest('form');var $attributes=$productForm.find('.super-attribute-select');var selectedOptions={};$attributes.each(function(){var $attr=$(this);selectedOptions[$attr.attr('id').replace('attribute','')]=$attr.val();});var productCode=$action.data('productCode');var productConfig=spConfig[productCode].config;var selectedVariantCode=null;$.each(selectedOptions,function(attrId,optionId){if(productConfig.attributes[attrId]&&productConfig.attributes[attrId].options){$.each(productConfig.attributes[attrId].options,function(_,option){if(option.id==optionId&&option.productCodes.length===1){selectedVariantCode=option.productCodes[0];}})}});var selectedProductCode=selectedVariantCode?selectedVariantCode:productCode;$action.data('disabled',true).addClass('btn-load');var apiResource=new csUtils.RestApiResource('wishlist/items');apiResource.create({product_code:selectedProductCode}).then(function(){$action.addClass('wishlist-saved disabled').parent().addClass('wishlist-saved-parent');$action.find('span span').text($action.data('savedTitle'));csModule(['loadWishlistMenu','wishlistItems'],function(loadWishlistMenu,wishlistItems){loadWishlistMenu();wishlistItems.refresh();});},function(resp){csUtils.notificationError(resp.message);$action.data('disabled',false);}).always(function(){$action.removeClass('btn-load');})});var _popupPlayer,_popupPlayerIsPlay,_popupPlayerType='';$container.find('.video-popup-link').on('click',function(){var _video=$(this).data('video'),_options='';if(_video){csUtils.openPopup({'name':'video-popup','class':'video-popup','addContent':function(popup,options){var $contentInner=$('.c_popup_inner',popup);if(_video.indexOf('youtube')!==-1||_video.indexOf('youtu.be')!==-1){_popupPlayerType='youtube';}else if(_video.indexOf('vimeo')!==-1){_popupPlayerType='vimeo';}
var $video=$('<video class="video-js" width="100%" height="100%"/>');popup.addClass('c_popup_loading');$contentInner.html($video);csModule(['videojs','videojsYoutube','videojsVimeo'],function(videojs){popup.removeClass('c_popup_loading');_popupPlayer=videojs($video[0],{'controls':true,'autoplay':false,'muted':true,'playsinline':true,'preload':'auto','techOrder':[_popupPlayerType],'youtube':{'playsinline':1},'sources':[{'type':'video/'+_popupPlayerType,'src':_video}]});_popupPlayer.play();_popupPlayer.muted(false);_popupPlayer.on('waiting',function(){var interval=setInterval(function(){if(_popupPlayer&&_popupPlayer.readyState()===0){_popupPlayer.removeClass('vjs-waiting');clearInterval(interval);}},1000);})
_popupPlayerIsPlay=true;});},'afterShow':function(popup,options){if(_popupPlayer&&_popupPlayer.play&&!_popupPlayerIsPlay){_popupPlayer.currentTime(0);_popupPlayer.play();_popupPlayerIsPlay=true;}},'beforeClose':function(popup,options){if(_popupPlayer&&_popupPlayer.pause&&_popupPlayerIsPlay){_popupPlayer.pause();_popupPlayerIsPlay=false;}}});}});function openZoomImagePopup(name,url,$container){var $items=$container.find('.more-views'),$video,_slider,_desktop=csBrowser.state==='desktop',_marginLeft=_desktop?123:0,_imgHeight=2000,_imgWidth=2000;if(_desktop){$video=$items.find('.video-item');if($video.length){_slider=$items.find('.slides').data('bxSlider');}}
csUtils.openPopup({'name':name,'class':'zoom-image-popup','refresh':true,'closeOnResize':true,'addContent':function(popup,options){var $imageWrap=$('<div class="image-wrap">');popup.addClass('c_popup_loading');var $img=$('<img/>');$img.attr('src',url).one('load',function(){$('.c_popup_inner',popup).html($imageWrap.css({'backgroundImage':'url('+url+')'}));popup.removeClass('c_popup_loading');options.popupAfterShow(popup,options);}).each(function(){if(this.complete)$(this).trigger('load');});$imageWrap.on('click',function(){popup.data('popupObj').close();});},'afterShow':function(popup){var $imageWrap=$('.image-wrap',popup);if(_desktop){$imageWrap.before($items);if($video.length){$video.detach();_slider.reloadSlider();}}
function imageZoom(){var _wHeight=$window.height()-22,_wWidth=$window.width()-_marginLeft-22;$imageWrap.off('mousemove touchmove').on('mousemove touchmove',function(e){e.preventDefault();setTimeout(function(){if(e.type.indexOf('touch')===0){var touchlist=e.touches||e.originalEvent.touches;var lx=touchlist[0].pageX;var ly=touchlist[0].pageY;}else{var lx=e.pageX;var ly=e.pageY;}
var _top=ly-11,_topPos=_top*100/_wHeight,_left=lx-12-_marginLeft,_leftPos=_left*100/_wWidth;if(_topPos<0)
_topPos=0;if(_topPos>100)
_topPos=100;if(_leftPos<0)
_leftPos=0;if(_leftPos>100)
_leftPos=100;if(_wHeight>_imgHeight)_topPos=0;if(_wWidth>_imgWidth)_leftPos=0;$imageWrap.css({'backgroundPosition':_leftPos+'% '+_topPos+'%'});},100);});}
if(_desktop){$items.off('click.zoomPopup').on('click.zoomPopup','li',function(){var $this=$(this),index=$this.attr('data-index'),src=$container.find('.slider-wrap').find('[data-index="'+index+'"]').children().attr('data-hrefx2');$imageWrap.addClass('load-image');$('<img/>').attr('src',src).one('load',function(){$imageWrap.removeClass('load-image').css({'backgroundImage':'url('+src+')','backgroundPosition':'0 0'});imageZoom();}).each(function(){if(this.complete)$(this).trigger('load');});});}
imageZoom();$window.on('resize',imageZoom);},'beforeClose':function(){if(_desktop){$container.find('.product-image-container').after($items);if($video.length){$items.find('li').first().after($video);var _count=csBrowser.state==='desktop'?4:3;_slider.reloadSlider({minSlides:_count,maxSlides:_count});}}}});}};});csModule(['domReady','initProductDetail'],function($,initProductDetail){var $body=$(document.body);if(!$body.hasClass('catalog-product-view'))return;if($body.hasClass('outfits-index-view')){initProductDetail($('.outfit-product-view'),false);}else{initProductDetail($('.product-view'),false);}});csModule('RestrictedProductDeliveryPopup',['domReady','csUtils','waitUntil'],function($,csUtils,waitUntil){return{init:function(restrictedCountries){if(Childrensalon.isAllowedDeliveryForRestrictedProducts){return;}
this.restrictedCountries=restrictedCountries;$($.proxy(this.onReady,this));},onReady:function(){var self=this;csUtils.getCountryCode().then(function(countryCode){var country=self.restrictedCountries[countryCode];if(country){self.open(country);}});},open:function(country){waitUntil.on(['loadTimeout'],function(){csUtils.openPopup({'name':'product_delivery_notice','class':'product-delivery-notice-popup','content':$('.product-delivery-notice'),'checkForOpenedPopup':true,'after':function(popup,options){$('.contact-us-link').on('click',function(){csModule(['EventTracker'],function(EventTracker){EventTracker.trackEvent('Product View','Restricted Product','Contact us');});});$('.btn_goback',popup).on('click',function(){csModule(['EventTracker'],function(EventTracker){EventTracker.scheduleEvent('Product View','Restricted Product','Go Back');});if(history.length>1){history.back();}else{popup.data('popupObj').close();}
return false;});$('.product-delivery-notice-country').text(country);csModule(['EventTracker'],function(EventTracker){EventTracker.trackEvent('Product View','Restricted Product','Unfortunately we are unable to ship this item. Please contact us if you have any questions.',1,true);});}});});}};});csModule('DuplicateAddToCartPopup',['jQuery','Class','csUtils','Cookies'],function($,Class,csUtils,Cookies){return Class.create({initialize:function(sku,variantProductCode){var self=this;self.sku=sku;self.variantProductCode=variantProductCode;self.openPopup()},openPopup:function(){var self=this;csUtils.openPopup({'name':'already_in_bag_popup','class':'already_in_bag_popup','content':$('#already_in_bag_popup'),'refresh':true,'after':function(popup){setTimeout(function(){self.popupObj=popup.data('popupObj');});$('.btn_no',popup).on('click',function(){self.popupObj.close();});$('.btn_yes',popup).on('click',function(){self.addToCart();});},'afterShow':function(){self.lastAutoCloseTimer=setTimeout(function(){self.addToCart();},15000);},'afterClose':function(){if(self.lastAutoCloseTimer){clearTimeout(self.lastAutoCloseTimer);}}});},addToCart:function(){var self=this;self.preventOpening();if(Childrensalon.catalogProductItem&&Childrensalon.catalogProductItem[self.sku]){$('.btn_yes',self.popupObj.popup).prop('disabled',true).addClass('btn-load');Childrensalon.catalogProductItem[self.sku].addToCart(false,self.variantProductCode,function(){self.popupObj.close();});}else{self.popupObj.close();}},preventOpening:function(){Cookies.set('skip_already_in_bag_popup',1);}});});csModule(['domReady','productBreadcrumbs','csProductBreadcrumbs'],function($,productBreadcrumbs,csProductBreadcrumbs){if(productBreadcrumbs){$('.color-filter').on('mousedown','a',function(){var currentReferrerProductListing=productBreadcrumbs.getReferrerProductListing();var productId=$(this).data('product');csProductBreadcrumbs.saveReferrerProductListing(productId,currentReferrerProductListing);});}});csModule('applyWishlistToProduct',['jQuery'],function($){return function(size,wrap){var $wishlistButton=$('.link-wishlist, .add-to-wishlist',wrap?wrap:'.product-view');var $titleEl=$wishlistButton.find('span span');var productCode=$wishlistButton.data('productCode');if(size){if(typeof spConfig!=='undefined'&&spConfig[productCode]){var productConfig=spConfig[productCode].config;var selectedVariantCode=null;$.each(productConfig.attributes,function(attrId,attr){if(attr.code==='size'){$.each(productConfig.attributes[attrId].options,function(_,option){if(option.id==size&&option.productCodes.length===1){selectedVariantCode=option.productCodes[0];}})}});if(selectedVariantCode){productCode=selectedVariantCode;}}else if(size.code){productCode=size.code;}}
csModule(['wishlistItems'],function(wishlistItems){wishlistItems.hasAddedProduct(productCode).then(function(){var savedTitle=$wishlistButton.data('savedTitle');$wishlistButton.data('disabled',true).attr('disabled',true).addClass('wishlist-saved');$titleEl.text(savedTitle);},function(){var origTitle=$wishlistButton.attr('title');$wishlistButton.data('disabled',false).attr('disabled',false).removeClass('wishlist-saved');$titleEl.text(origTitle);});});}});
csModule('CatalogProductItem',['domReady','formatCurrency','Class','Validation','FormValidation','csUtils','ajaxCart','baseEventTracker'],function($,formatCurrency,Class,Validation,FormValidation,csUtils,ajaxCart,baseEventTracker){return Class.create({_initUi:function(){var self=this;Childrensalon.catalogProductItem=Childrensalon.catalogProductItem||{};Childrensalon.catalogProductItem[self.product.code]=self;self.$select=self.$form.find('.super-attribute-select');self.vForm=new FormValidation(self.$form);self.$cartButton=self.$el.find('.btn-cart');self._initSelect();},_formatPrice:function(price){return formatCurrency(price,this.options.priceFormat,false);},_updatePrice:function(product){var self=this;self.$el.find('.regular-price .price, .special-price .price').text(self._formatPrice(product.salePrice));self.$el.find('.old-price .price').text(self._formatPrice(product.price));},validateForm:function(){return this.vForm.validate();},_toggleButtons:function(product){var self=this;self.$form.find('.btn-cart').toggleClass('no-display',!product.isInStock);self.$form.find('.emailme-stock-btn').toggleClass('no-display',product.isInStock);if(product.code){self.$form.find('.emailme-btn').data('productCode',product.code);}},addToCart:function(checkDuplicate,variantProductCode,cb){var self=this,$cartButton=self.$cartButton;if(window.ajaxCartDisabled){return;}
if(variantProductCode){self._postToCart(variantProductCode,checkDuplicate,false,cb);return;}
if($cartButton.prop('disabled')){return;}
if(variantProductCode||self.validateForm()){$cartButton.removeClass('btn-red');$cartButton.prop('disabled',true).addClass('btn-load');self._postToCart(self.$select.val(),checkDuplicate,true);}else{$cartButton.addClass('btn-red');}},disablePostToCart:function(){this.isPostToCartDisabled=true;},_postToCart:function(code,checkDuplicate,track,cb){var self=this;if(self.isPostToCartDisabled){return;}
var productData=this.getProductData();productData['product_code']=code;productData['category_path']=self.$form.data('category-path');new csUtils.RestApiResource('checkout/cart/items').create(productData,{'check_duplicate':checkDuplicate,'origin':'product-detail'}).then(function(resp){cb&&cb();self.onAddToCartSuccess(track);if(resp.data&&resp.data.errors){resp.data.errors.forEach(function(error){csUtils.notificationError(error);});}
if(track){baseEventTracker.addProductToCart(productData);csModule(['ometriaAddToCart'],function(ometriaAddToCart){ometriaAddToCart(code);});}
if(resp.data&&resp.data.updatedCart){baseEventTracker.cartUpdate(resp.data.updatedCart)}
if(typeof RecommendApp!='undefined'&&resp['data']&&resp['data']['cart']){csModule(['recommendTracker'],function(recommendTracker){recommendTracker.sendCartData(resp['data']['cart']);})}},self.onAddToCartError.bind(self)).always(function(){self.$cartButton.prop('disabled',false).removeClass('btn-load');});},getProductData:function(){var formData=this.$form.serializeArray();var productData={};$.each(formData,function(_,inputData){productData[inputData['name']]=inputData['value'];});return productData;},resetValidation:function(){Validation.reset(this.$select);},onAddToCartSuccess:function(){ajaxCart.showBag(true,true);},onAddToCartError:function(resp){csUtils.notificationError(resp.message);},_initSelect:function(){var self=this;csModule(['$.ui'],self._initCustomSelect.bind(self));self.$select.on('change',self.onChange.bind(self));},_initCustomSelect:function(){var self=this,$select=self.$select,selectmenu=$select.selectmenu('instance');if(!$select.length){return;}
if(selectmenu){selectmenu.refresh();return;}
$select.addClass('super-attribute-select-hide');csUtils.selectMenu($select,{width:'auto',position:{my:"left top",at:"left top",collision:"none"},change:function(){$select.trigger('change');},create:function(){$select.selectmenu('instance').menuWrap.addClass('size-dropdown');},select:function(event,ui){var variantCode=ui.item.value;if(variantCode){$select.selectmenu('instance').buttonText.text(self.options.selectedSizeCopy+' '+self.product.variants[variantCode].size.label);}}});$select.selectmenu('instance')._renderItem=self._customSelectRenderItem.bind(self);},_customSelectRenderItem:function(ul,option){var self=this,variantCode=option.value,product=self.product,selectedHref=option.element[0].dataset.href,item=$("<li>");if(variantCode){var variant=self.product.variants[variantCode];if(product.isSale){item.html('<div class="td">'+variant.size.label+'</div><div class="td"><span class="old-price">'+self._formatPrice(variant.price)+'</span></div><div class="td"><span class="special-price">'+self._formatPrice(variant.salePrice)+'</span></div>');}else{item.html('<div class="td">'+variant.size.label+'</div><div class="td">'+self._formatPrice(variant.price)+'</div><div class="td last"><div class="email-label"><i class="fi fi-email"></i></div></div>');}
var isOutOfStock=!product.isPreview&&!variant.isInStock;if(isOutOfStock){item.addClass('option-out-of-stock');}
var hasStockAlert=isOutOfStock&&!product.isSale;if(hasStockAlert){var $tooltip=$('<div class="stock-alert-option cs-tool-tip">'+self.options.stockAlertText+'</div>');item.addClass('option-stock-alert');item.find('.label').append($tooltip);item.mousemove(function(ev){$tooltip.position({my:"left-18 bottom-22",of:ev,collision:'none'});});}
item.on('click',function(e){if(isOutOfStock){e.stopImmediatePropagation();self.$select.selectmenu('instance').close();}
if(hasStockAlert){csModule(['subscribeProduct'],function(subscribeProduct){subscribeProduct(variantCode);});}});}else{if(product.isSale){item.html('<div class="td">'+option.label+'</div><div class="td"></div><div class="td"></div><div class="td last"></div>');}else if(selectedHref){item.addClass('option-shop-more');item.html(option.label);item.on('click',function(e){csUtils.preloadPopup('openLoadingPopup');e.stopImmediatePropagation();self.$select.selectmenu('instance').close();window.location.href=selectedHref;});}else{item.html('<div class="td">'+option.label+'</div><div class="td"></div><div class="td last"></div>');}}
return item.appendTo(ul);}});});
csModule('Component.CatalogOutfit',['jQuery','FormValidation','Class','CatalogProductItem','formatCurrency','ajaxCart','csUtils','Validation','EventTracker','wishlistItems','baseEventTracker'],function($,FormValidation,Class,CatalogProductItem,formatCurrency,ajaxCart,csUtils,Validation,EventTracker,wishlistItems,baseEventTracker){'use strict';var OutfitItem=CatalogProductItem.create({initialize:function($form,config,wrapperObj){var self=this;if(typeof config==='undefined')return;self.$el=$form;self.$form=$form;self.product=config.product;self.options=config.options;self.wrapperObj=wrapperObj;self.selectedProduct=self.product;self._initUi();},_initUi:function(){var self=this;self._super();self.$form.on('validatedSubmit',self.onSubmit.bind(self));if(self.$select.val()){self.onChange();}},onChange:function(){var self=this,selectedCode=self.$select.val(),selectedProduct=selectedCode?self.product.variants[selectedCode]:self.product;self.selectedProduct=selectedProduct;self._updatePrice(selectedProduct);self._toggleButtons(selectedProduct);self.resetValidation();if(selectedProduct.isInStock&&!self.product.isPreview){self.wrapperObj.changePrice({sku:self.product.code,price:selectedProduct.price,salePrice:selectedProduct.salePrice});}
if(self.wrapperObj.hasWishlist)self.checkWishlist();},onSubmit:function(){this.addToCart(this.options.checkDuplicate);},onAddToCartSuccess:function(track){if(track){EventTracker.vent.trigger('outfitAddItemToBag',{sku:this.product.code});}
this._super();},checkWishlist:function(){var self=this;wishlistItems.hasAddedProduct(self.selectedProduct.code).then(function(){self.wislistAdded=true;},function(){self.wislistAdded=false;}).always(function(){self.wrapperObj.checkOnWishlistAded();})},setWislistAdded:function(){this.wislistAdded=true;}});var CatalogOutfit=Class.create({initialize:function($el){var self=this;self.$el=$el;self.outfitId=$el.data('id');self.hasWishlist=$el.data('hasWishlist');if(!self.outfitId||!Childrensalon.outfitConfig||!Childrensalon.outfitConfig[self.outfitId])return;self.outfitConfig=Childrensalon.outfitConfig[self.outfitId];$el.data('csOutfit',self);self.init();},init:function(){var self=this;if(!self.isSaleable()){self.$el.find('.actions').addClass('no-display');}
self.initPrices();self.initForms();if(self.hasWishlist)self.initWishlist();self.$el.find('.actions .btn-cart').on('click',$.proxy(self,'onSubmit'));},isSaleable:function(){var isSaleable=false;$.each(this.outfitConfig,function(k,v){if(v.product.isInStock&&!v.product.isPreview){isSaleable=true;return false;}});return isSaleable;},initForms:function(){var self=this;self.forms=[];this.$el.find('form').each(function(_,form){var $form=$(form),sku=$form.attr('data-sku');self.forms.push(new OutfitItem($form,self.outfitConfig[sku],self));});},initPrices:function(){var self=this;self.prices={};$.each(self.outfitConfig,function(k,v){self.priceFormat=v.options.priceFormat;if(v.product.isInStock&&!v.product.isPreview){self.prices[k]={price:v.product.price,salePrice:v.product.salePrice}}});},changePrice:function(data){var self=this;self.prices[data.sku]={price:data.price,salePrice:data.salePrice};self.updatePrices();},updatePrices:function(){var self=this,price=0,salePrice=0;$.each(self.prices,function(k,v){price+=parseFloat(v.price);salePrice+=parseFloat(v.salePrice);});self.$el.find('.actions .regular-price, .actions .special-price').text(this.formatPrice(salePrice));self.$el.find('.actions .old-price').text(this.formatPrice(price));},formatPrice:function(price){return formatCurrency(price,this.priceFormat,false);},onSubmit:function(){if(window.ajaxCartDisabled)return;var self=this,codes=[],$button=self.$el.find('.btn-cart'),valids=[];$(self.forms.slice().reverse()).each(function(_,form){if(!form.selectedProduct.isInStock||form.product.isPreview)return;var validate=form.validateForm();valids.push(validate);if(validate&&codes!==null){codes.push(form.selectedProduct.code);}else{codes=null;}});self.$el.trigger('validateOutfits',{valids:valids.reverse()});if(codes!==null&&codes.length){$button.attr('disabled','disabled').addClass('btn-load');csModule(['ometriaAddToCart'],function(ometriaAddToCart){$.each(codes,function(_,item){ometriaAddToCart(item);});});new csUtils.RestApiResource('checkout/cart/items').create({product_codes:codes},{origin:'outfit'}).then(function(resp){EventTracker.vent.trigger('outfitAddToBag',{id:self.outfitId});codes.forEach(function(code){baseEventTracker.addProductToCart({'product_code':code,'category_path':'outfit'});});if(resp.data&&resp.data.updatedCart){baseEventTracker.cartUpdate(resp.data.updatedCart)}
ajaxCart.showBag(true,true);}.bind(self),function(resp){csUtils.notificationError(resp.message);}).always(function(){$button.removeAttr('disabled').removeClass('btn-load');});}},initWishlist:function(){var self=this;self.$el.find('.btn-wishlist').on('click',self.onAddToWishlist.bind(self));wishlistItems.getProducts().then(function(products){$(self.forms).each(function(_,form){var productCode=form.selectedProduct.code;for(var i=0;i<products.length;i++){if(productCode===products[i].code){form.setWislistAdded();break;}}});self.checkOnWishlistAded();});},checkOnWishlistAded:function(){var self=this,added=true,$btn=self.$el.find('.actions .btn-wishlist'),btnDisabled=$btn[0].disabled;$(self.forms).each(function(_,form){if(!form.wislistAdded){added=false;return false}});if(added){if(!btnDisabled){$btn.prop('disabled',true).find('span span').text($btn.attr('data-saved-title'));}}else{if(btnDisabled){$btn.prop('disabled',false).find('span span').text($btn.attr('title'));}}},onAddToWishlist:function(){var self=this,codes=[],$button=self.$el.find('.btn-wishlist'),valids=[];$(self.forms).each(function(_,form){if(!form.wislistAdded){codes.push(form.selectedProduct.code);}});this.$el.trigger('validateOutfits',{valids:valids.reverse()});if(codes.length){EventTracker.vent.trigger('outfitAddToWishlist',{id:self.outfitId});$button.prop('disabled',true).addClass('btn-load');new csUtils.RestApiResource('wishlist/items').request('post','/_masscreate',{product_codes:codes}).then(function(){$button.find('span span').text($button.attr('data-saved-title'));csModule(['loadWishlistMenu'],function(loadWishlistMenu){loadWishlistMenu();wishlistItems.refresh();});},function(resp){$button.prop('disabled',false);csUtils.notificationError(resp.message);}).always(function(){$button.removeClass('btn-load');})}}});return function($el){new CatalogOutfit($el);}});
csModule('CatalogProductView',['jQuery','applyWishlistToProduct','csUtils','CatalogProductItem','EventTracker'],function($,applyWishlistToProduct,csUtils,CatalogProductItem,EventTracker){return CatalogProductItem.create({initialize:function(el,product,options){var self=this;self.el=el;self.product=product;self.options=options;self.$el=$(self.el);self.$form=self.$el.find('form');self._initUi();},_initUi:function(){var self=this;self._super();self.$el.find('.add-to-links [data-action=add-to-wishlist]').on('click',self.onAddToWishlist.bind(self));self.$cartButton.on('click',self.onAddToCart.bind(self));self.onChange();},onChange:function(e){var self=this,selectedVariantCode=self.$select.val(),selectedProduct=selectedVariantCode?self.product.variants[selectedVariantCode]:self.product,selectedHref=self.$select.find(':selected').data('href');self.$el.find('.add-to-cart .btn').removeClass('btn-red');self.$form.addClass('hide-validation');if(selectedHref&&e){self.$select.val('');csUtils.preloadPopup('openLoadingPopup');window.location.href=selectedHref;}
if(selectedVariantCode){self.$el.find('.add-to-cart').addClass('size-selected');}else{self.$el.find('.add-to-cart').removeClass('size-selected');}
self._updateLowStockMessage(selectedProduct);self._updatePrice(selectedProduct);self._updateWishlist(selectedProduct);self._toggleButtons(selectedProduct);self.resetValidation();self.$form.removeClass('hide-validation');},onAddToWishlist:function(e){e.preventDefault();var $action=$(e.target).closest('[data-action]');var productCode=this.$select.val();if(!productCode){productCode=$action.data('productCode');}
$action.prop('disabled',true).addClass('btn-load');var apiResource=new csUtils.RestApiResource('wishlist/items');apiResource.create({product_code:productCode}).then(function(){$action.addClass('wishlist-saved').parent().addClass('wishlist-saved-parent');$action.find('span span').text($action.data('savedTitle'));csModule(['loadWishlistMenu','wishlistItems'],function(loadWishlistMenu,wishlistItems){loadWishlistMenu();wishlistItems.refresh();});},function(resp){csUtils.notificationError(resp.message);$action.prop('disabled',false);}).always(function(){$action.removeClass('btn-load');})},onAddToCart:function(e){e.preventDefault();this.addToCart(this.options.checkDuplicate);},onAddToCartSuccess:function(track){if(track){EventTracker.vent.trigger('productAddToBag');}
this._super();},_updateLowStockMessage:function(product){var $el=this.$el.find('#stock-qty-'+product.code);this.$el.find('.stock-qty').each(function(index,_el){$(_el).addClass('no-display');});if($el.length){$el.removeClass('no-display');}},_updateWishlist:function(product){applyWishlistToProduct(product,this.$el);}});});
csModule(['domReady','EventTracker'],function($,EventTracker){'use strict';if(EventTracker.disableTracking){return;}
var $body=$(document.body);if($body.hasClass('catalog-product-view')){var $productInfo=$('.product-info'),$productView=$('.product-view');var productStatus=function(){var productStatus=$('.page-title').data('status');var productStatusLabel;switch(productStatus){case'sold-out':productStatusLabel='Sold Out';break;case'coming-soon':productStatusLabel='Coming Soon';break;case'coming-back-soon':productStatusLabel='Coming Back Soon';break;default:productStatusLabel='Default';break;}
return productStatusLabel;}();$body.find('.swipe-menu, .switcher-currency').on('change','.currencySelect',function(){EventTracker.scheduleEvent('Product View','Currency Switch');});$body.find('.more-views ul').on('click','li',function(){setTimeout(function(){EventTracker.trackEvent('Product View','Thumbnail');},0)});$productInfo.find('.product-designer').on('click',function(){EventTracker.trackEvent('Product View','Brand Name',productStatus);});$productInfo.on('click','.view-product-detail',function(){setTimeout(function(){EventTracker.trackEvent('Product View','View Product Details',productStatus);},0);});EventTracker.vent.on('productAddToBag',function(){EventTracker.trackEvent('Product View','Add to Bag');});$productInfo.on('click','button.btn-cart',function(){var sizeSelected=$productInfo.find('select.validate-attribute-size').hasClass('validation-failed');if(sizeSelected){EventTracker.trackEvent('Product Page','Unsuccessful Add to Cart','Please select size first',1,true);}});$productInfo.find('.add-to-links .link-wishlist').on('click',function(){EventTracker.trackEvent('Product View','Add to Wishlist',productStatus);});$productInfo.find('.color-filter .items').on('click','a',function(){EventTracker.scheduleEvent('Product View','Color Swatch');});$productInfo.on('click','.read-more',function(){setTimeout(function(){EventTracker.trackEvent('Product View','Read More Link');},0);});$productInfo.find('.block-more-links .block-content').on('click','li',function(){var type=$(this).data('type');if(typeof type!=='undefined'){EventTracker.scheduleEvent('Product View','View More',type);}});$body.find('.youmightlike-tab').on('click',function(){EventTracker.trackEvent('Product View','Tabs','You Might Like')});$body.find('.recommend-grid').on('click','.item',function(){EventTracker.scheduleEvent('Product View','You Might Like Grid',productStatus);});$body.find('.sizeguide-tab').on('click',function(){EventTracker.trackEvent('Product View','Tabs','Help With Size');});$body.find('.measurments-tabtitle').on('click',function(){EventTracker.trackEvent('Product View','Tabs','Measurements')});$body.find('.deliveryreturns-tab').on('click',function(){EventTracker.trackEvent('Product View','Tabs','Delivery & Returns');});$body.find('.outfit-tab').on('click',function(){EventTracker.trackEvent('Product View','Tabs','Shop Outfit');});$body.find('.recommend-product-list').on('click','.slides li',function(){EventTracker.scheduleEvent('Product View','You Might Like Item',productStatus)});if($productView.length){$('.tab-box, .rocket-tab-box').on('click','.slides .item',function(){var $this=$(this),$tab=$this.closest('.tab-slides'),type=$tab.data('type');if(type){EventTracker.scheduleEvent('Product View',type,'Item');}});}
$productView.find('.social-links').on('click','li',function(){var className=$(this).attr('class'),buttonLabel=EventTracker.capitalize(className).split(' ').pop();EventTracker.trackEvent('Social','Interactions',buttonLabel);});$productView.find('button.emailme-preview-btn').on('click',function(){EventTracker.trackEvent('Product Page','Email me when it arrives',productStatus);});$productView.find('.emailme-stock-btn').on('click',function(){EventTracker.trackEvent('Product Page','Email me when back in stock',productStatus);});$body.find('#product_delivery_notice').on('click','a',function(){var button=$(this);if(button.parent().hasClass('col-live-chat')){EventTracker.trackEvent('Product View','Restricted Product','Live Chat');}});}
if($body.hasClass('outfits-index-view')||$body.hasClass('catalog-product-view')&&$('.outfit-tab').length){var outfitAdded=false;EventTracker.vent.on('outfitAddToBag',function(args){if(!outfitAdded){EventTracker.trackEvent('Outfit View','Add Outfit to Bag',args.id);outfitAdded=true;}});EventTracker.vent.on('outfitAddItemToBag',function(args){EventTracker.trackEvent('Outfit View','Add Item to Bag',args.sku);});}});
csModule('Component.personalisedProductFields',function(){return function($el){$el.find('.font-items').on('change','[type="radio"]',function(e){var newClass='label-font-'+e.currentTarget.value,$copy=$el.find('.personalised-copy .input-text');$copy.removeClass(function(_,className){return(className.match(/label-font-\w+/g)||[]).join(' ');}).addClass(newClass);});$el.on('change','[type="radio"]',check);$el.find('.input-text').on('input',function(){check();$(this).trigger('focus');});function check(){var $form=$el.closest('.product_addtocart_form'),$cartButton=$form.find('.btn-cart');if($cartButton.hasClass('btn-red')&&$form.data('FormValidation').validate()){$cartButton.removeClass('btn-red');}}}});
csModule('FreeProducts',['jQuery','Storage','csUtils','waitUntil'],function($,Storage,csUtils,waitUntil){window.FreeProducts={init:function(options){this.options=options;if(options.allowShowPopupOnLoad&&!_Storage.hasPromotion(options.websiteId+'_'+options.promotionId)){this.openInitialPromotion();}
$('.free-gift-link').removeClass('no-display').on('click',$.proxy(this,'openTabPromotion'));},openInitialPromotion:function(){var that=this;this.openPopup({'name':'fpp_initial_popup','url':this.options.viewUrl,'after':function(){_Storage.addPromotion(that.options.websiteId+'_'+that.options.promotionId);}});},openTabPromotion:function(){var timer,_hover=false;this.openPopup({'name':'fpp_banner_popup','class':'fpp_popup fpp_banner','url':this.options.listUrl,'after':function(popup,options){if($('.slides > li',popup).length>1){$('.fpp-slider',popup).flexslider({animation:"slide",touch:false,slideshowSpeed:5000,pauseOnHover:true,keyboard:false});}
$('.btn_shop',popup).on('click',function(){var promotionId=$(this).data('promotion-id');if(promotionId)
_Storage.addPromotion(promotionId);});}});},openSuccessPopup:function(){var self=this;this.openPopup({'name':'fpp_success_popup','content':$('.fpp_done'),'after':function(popup,options){var $sizeSelect=$('#free_promotion_size');var $continue=$('#free_promotion_continue_btn');if($sizeSelect.length){$sizeSelect.on('change',function(){if($sizeSelect.val()){$continue.removeClass('disabled');}else{$continue.addClass('disabled');}});$continue.on('click',function(){var url=$sizeSelect.data('url');if($sizeSelect.length&&$sizeSelect.val()){self.changeSize(url,$sizeSelect);}});}}});},openPopup:function(options){waitUntil.on(['loadTimeout'],function(){options=options||{};var afterCallback=options.after;delete options.after;csUtils.preloadPopupContent($.extend({'class':'fpp_popup','checkForOpenedPopup':true,'after':function(popup,options){$('.btn_close, .big_close',popup).on('click',function(e){e.preventDefault();popup.data('popupObj').close();});afterCallback&&afterCallback(popup,options);}},options));});},changeSize:function(url,selectEl){var $select=$(selectEl),size=$select.val();url=url.replace('size',size);window.location.href=url;}};var _Storage={cookieName:'fpp',addPromotion:function(promotionId){var promotions=this.getPromotions();promotions.push(promotionId);this.setPromotions($.unique(promotions));},hasPromotion:function(promotionId){return this.getPromotions().indexOf(promotionId)!==-1;},getPromotions:function(){var promotions=Storage.get(this.cookieName);return promotions?promotions:[];},setPromotions:function(promotions){Storage.set(this.cookieName,promotions);}};return FreeProducts;});